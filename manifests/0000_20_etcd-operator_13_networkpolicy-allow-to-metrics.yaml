# Allow ingress to the metrics endpoint from Prometheus.
# The etcd-operator exposes metrics on port 8443 (containerPort) which is mapped
# to port 443 via the "metrics" service.
#
# This policy allows Prometheus (and other monitoring components) running in namespaces
# with the host-network policy group label to scrape metrics from the operator.
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-to-metrics
  namespace: openshift-etcd-operator
  annotations:
    include.release.openshift.io/self-managed-high-availability: "true"
    include.release.openshift.io/single-node-developer: "true"
spec:
  podSelector:
    matchLabels:
      app: etcd-operator
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          policy-group.network.openshift.io/host-network: ""
    ports:
    - protocol: TCP
      port: 8443
  policyTypes:
  - Ingress
