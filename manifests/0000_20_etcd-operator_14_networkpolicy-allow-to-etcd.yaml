# Allow egress to etcd endpoints.
# The etcd-operator needs to communicate with etcd pods to:
# - Manage the etcd cluster (add/remove members)
# - Check etcd health and status
# - Perform backup and restore operations
#
# IMPORTANT: etcd pods run with hostNetwork: true, which means they bypass
# NetworkPolicy entirely. Since the operator needs to connect to etcd on the
# host network, we must allow egress to the etcd client port (2379) and
# metrics ports (9978, 9979) without destination restrictions.
#
# Note: We allow egress on these specific ports to any destination because:
# 1. etcd runs on the host network and is accessed via node IPs
# 2. NetworkPolicy cannot select host-networked pods
# 3. The operator discovers etcd endpoints dynamically via the API server
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-to-etcd
  namespace: openshift-etcd-operator
  annotations:
    include.release.openshift.io/self-managed-high-availability: "true"
    include.release.openshift.io/single-node-developer: "true"
spec:
  podSelector:
    matchLabels:
      app: etcd-operator
  egress:
  - ports:
    - protocol: TCP
      port: 2379
    - protocol: TCP
      port: 9978
    - protocol: TCP
      port: 9979
  policyTypes:
  - Egress
